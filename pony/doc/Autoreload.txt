Автоматическая перезагрузка
===========================


При старте веб-приложения исполняемые файлы считываются с диска и запускаются в памяти компьютера.
Если разработчик вносит в приложение какие-то изменения, нужно перезапустить приложение, чтобы изменения вступили в силу.

Если приложение находится в стадии разработки, то изменения вносятся постоянно.
Перезапуск приложения каждый раз становится неудобным и отнимает время.

Пони позволяет осуществлять автоматическую перезагрузку файлов приложения при их изменении.
Для этого служит функция use_autoreload()

Чтобы включить автоматическую перезагрузку нужно добавить строку

    use_autoreload()

после всех импортов в главном модуле веб-приложения.
Например:

    from pony.main import *

    use_autoreload()

    @http
    def page1():
        return "Hello, world!"
    
Теперь Пони будет следить за файлами приложения. Если содержимое хоть одного из них меняется, Пони перезагружает
все файлы приложения.

На данный момент автоматическая перезагрузка средствами Пони поддерживается при использовании веб-сервера CherryPy и модуля flup.
Если Пони используется из mod_wsgi или GAE, то они сами отвечают за перезагрузку. 




### Технические особенности автоматической перезагрузки

При старте Пони разделяет модули на две части - "системные" и "пользовательские".
Системные модули не перегружаются, даже если в них произошли изменения.
Пони отслеживает изменения только в "пользовательских" модулях.

Системные модули не должны содержать ссылок на "пользовательские" модули.
При наличии таких ссылок объекты из старого модуля могут оставаться в памяти до полной перезагрузки приложения.
При перезагрузке происходит одновременная перезагрузка "пользовательских" модулей.
Системные модули при этом не трогаются.

Чтобы импортировать компоненты Пони разработчик в своем модуле делает импорт:

    from pony.main import *

Из модуля pony.main импортируются все необходимые компоненты Пони, в том числе константа 
USE_AUTORELOAD. 
Таким образом Пони отличает "пользовательский" модуль от "системного" - по наличию в модуле константы
USE_AUTORELOAD.
Разработчик может отключить перезагруку для конкретного модуля указав в начале модуля

    USE_AUTORELOAD = False

Если разработчик выполняет импорт компонентов другим способом(отличным от from pony.main import *),
тогда для автоматической перезарузки нужно указывать константу

    USE_AUTORELOAD = True

в начале модуля явно.
Таким образом, когда разработчик указывает в начале главного модуля

    use_autoreload()

Пони выбирает модули, которые содержат в себе константу USE_AUTORELOAD = True и автоматически перегружает
эти модули, если в них произошли изменения.

Многие популярные фреймворки осуществляют перезагрузку с помощью рестарта всего веб-приложения.
При частой перезагрузке такой подход отнимает время. Пони реализует перезагрузку пользовательских модулей
без рестарта процесса, в котором запущено веб-приложение. Перезагружаются только пользовательские модули.
При этом, непостредственно в момент перезагрузки Пони работает со старой версией модуля.
После перезагрузки новые запросы к веб-приложению будут использовать уже обновленный модуль. 




### Декоратор @on_reload

Если функция декорирована с помощью @on_reload, она будет вызвана в момент срабатывания автоматической перезагрузки
пользовательских модулей.
